# TCP/UDP/HTTP/HTTPS

## TCP

> TCP（Transmission Control Protocol，传输控制协议）提供的是面向连接，可靠的字节流服务。<br>即客户和服务器交换数据前，必须现在双方之间建立一个TCP连接，之后才能传输数据。并且提供超时重发，丢弃重复数据，检验数据，流量控制等功能，保证数据能从一端传到另一端。  

TCP特点：**面向连接、可靠传输、面向字节流**

* 面向连接：客户端和服务端的[三次握手，四次挥手](/java/TCP三次握手四次挥手.md)。
* 可靠传输：序列号，确认应答机制，超时重传，拥塞控制(每次发送数据包的时候, 将拥塞窗口和接收端主机反馈的窗口大小做比较, 取较小的值作为实际发送的窗口，提高传输的效率)。
* 面向字节流：创建一个TCP的socket, 同时在内核中创建一个发送缓冲区和一个接收缓冲区；另一方面, TCP的一个连接, 既有发送缓冲区, 也有接收缓冲区, 那么对于这一个连接, 既可以读数据, 也可以写数据. 这个概念叫做全双工。

## UDP

> UDP（User Data Protocol，用户数据报协议）是一个简单的面向数据报的传输层协议。<br>UDP不提供可靠性，只是把应用程序传给IP层的数据报发送出去，但是不能保证它们能到达目的地。由于UDP在传输数据报前不用在客户和服务器之间建立一个连接，且没有超时重发等机制，所以传输速度很快。

UDP特点：**无连接、不可靠、面向数据报、数据接收不够灵活**

* 无连接：知道对端的IP和端口号就直接进行传输, 不需要建立连接。  
* 不可靠：没有确认机制, 没有重传机制; 如果因为网络故障该段无法发到对方, UDP协议层也不会给应用层返回任何错误信息。  
* 面向数据报：不能够灵活的控制读写数据的次数和数量，应用层交给UDP多长的报文, UDP原样发送, 既不会拆分, 也不会合并。  
* 数据接收不够灵活：但是能够明确区分两个数据包，避免粘包问题。

**TCP/UDP的相同点：**

TCP协议和UDP协议都是**传输层**协议。

**TCP/UDP的不同点：**

|不同点|TCP|UDP|
|--|--|--|
|报头不同|报头最大长度60个字节|UDP数据报最大长度64K（包含UDP首部），如果数据长度超过64K就需要在应用层手动分包，UDP无法保证包序，需要在应用层进行编号|
|特点不同|面向连接，可靠传输，面向字节流|无连接，不可靠，面向数据报，数据接收不够灵活|
|协议不同|**HTTP**(超文本传输协议)、**HTTPS**(超文本传输安全协议)、**SSH**(安全外壳协议)、**Telnet**(电信网络协议)、**FTP**(文件传输协议)、**SMTP**(简单邮件传输协议)|**NFS**(网络文件系统)、**TFTP**(简单文件传输协议)、**DHCP**(动态主机配置协议)、**BOOTP**(启动协议, 用于无盘设备启动)、**DNS**(域名解析协议)|

> *TCP粘包问题：*  
首先要明确，粘包问题中的*包*，是指的应用层的数据包；  
在TCP的协议头中，没有如同UDP一样的*报文长度*这样的字段，但是有一个序号这样的字段；  
站在传输层的角度，TCP是一个一个报文过来的，按照序号排好序放在缓冲区中；  
站在应用层的角度，看到的只是一串连续的字节数据，那么应用程序看到了这么一连串的字节数据，就不知道从哪个部分开始到哪个部分是一个完整的应用层数据包。  
*解决方案：明确两个包之间的边界*     
1、对于定长的包，保证每次都按固定大小读取即可;  
2、对于变长的包，可以在报头的位置, 约定一个包总长度的字段, 从而就知道了包的结束位置;  
3、对于变长的包，还可以在包和包之间使用明确的分隔符；  
4、TLV格式的数据传输。

## Http

> Http：是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准（TCP），用于从WWW服务器传输超文本到本地浏览器的传输协议，它可以使浏览器更加高效，使网络传输减少。

Http特点：**支持客户/服务器模式、简单快速、灵活、无连接、无状态**

- 支持客户/服务器模式。（C/S模式）  
- 简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、HEAD、POST。每种方法规定了客户与服务器联系的类型不同。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。  
- 灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。  
- 无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。  
- 无状态：HTTP协议是无状态协议，无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大，另一方面，在服务器不需要先前信息时它的应答就较快。  

## Http2

### HTTP1.1相对于1.0的优化

- 缓存的处理：1.0根据header头的expires作为缓存依据，1.1引入了更多的缓存控制策略。（Entity tag、If-match）  
- 带宽的优化：1.0请求对象时服务器会返回整个对象，并且不支持断点续传，1.1在请求头加入了range头域，可以请求资源的某一部分，节省了带宽。  
- host处理：1.1中请求和响应都支持host头域，请求中没有的话会报错（400）。支持host头域是因为一个服务器可以部署多个虚拟主机。
- 长链接优化：一个TCP连接可以传送多个HTTP请求和响应，减少了建立多个连接的消耗和延迟，默认打开了keep-alive，一定程度上弥补了1.0每次请求都要重新连接的缺陷。

### HTTP2.0相对于1.x的优化

- HTTP2请求报文头部采用二进制格式传输，取代了HTTP1.x的文本格式，二进制格式解析更高效。  
- 在HTTP1.0/1.1中，每次请求都会建立一次TCP连接，也就是3次握手4次挥手，这个过程在一次请求过程中占用了比较长的时间，即使1.1版本开启了Keep-Alive，解决了多次连接的问题，但是依然有两个效率上的问题：串行文件传输消耗时间（单通道）、连接数过多服务器承载的最大并发数有限。  
HTTP2的**多路复用**解决了这个问题，在一个TCP连接中可以存在多个流，通过帧中的标识知道属于哪个请求，可以避免HTTP旧版本中的线头阻塞问题，极大的提高了传输效率。

**多路复用**
- 同域名下所有通信都在单个连接上完成，消除了因多个TCP连接而带来的延时和内存消耗。
- 单个连接上可以并行交错的请求和响应，之间互不干扰。

## Https

> Https：是以安全为目标的HTTP通道，简单讲是Http的安全版，即Http下加入SSL层，Https的安全基础是SSL，因此加密的详细内容就需要SSL。

Https特点：**安全性高、技术门槛高**

- 安全性高：相比于http，https可以提供更加优质保密的信息，保证了用户数据的安全性，此外https同时也一定程度上保护了服务端，使用恶意攻击和伪装数据的成本大大提高。  
- 技术门槛高：https技术门槛较高, 同时加重了服务端的负担，相比于http其需要更多的资源来支撑，同时也降低了用户的访问速度。

HTTPS加密过程：认证服务器 - 协商会话秘钥 - 加密传输

**Http/Https的不同点：**

|区别|Http|Https|
|--|--|--|
|端口|80|443|
|证书|不需要|需要到CA申请证书，一般免费证书较少，因而需要一定费用|
|传输方式|明文传输|具有安全性的ssl加密传输|
|安全性|连接简单，无状态，安全性低|ssl+http构建的可进行加密传输、身份认证的网络协议，更加安全|

### SSL简介

> 安全套接字层（Secure Socket Layer）是为了弥补HTTP协议的一些缺陷而产生的一个协议层。

位置：**HTTP - SSL - TCP**

在SSL中应用了**非对称加密**和**对称加密**来实现密钥和报文的加密传输，同时可以进行身份验证的功能。

- 首先应有一个可靠的第三方机构，负责将可信机构的公钥嵌入客户端浏览器中，服务器端将生成的公钥发送给可信机构，可信机构使用自己的私钥对其进行加密生成公钥证书，之后将证书发送给服务器端。
- 客户端向服务端发送请求，服务器端使用加密好的公钥证书对返回报文进行加密，并传输给客户端。
- 客户端浏览器用认证机构的公钥对证书进行检验，并获得公钥。 