# Https的请求过程
    
**第一步：DNS解析获取服务器IP和端口号**
- 本地dns解析器缓存
- host文件域名映射
- dns服务器查询获取解析

**第二步：TCP三次握手链接**
- 客户端发送syn数据包给服务器（在吗）
- 服务器收到后返回一个syn响应包给客户端（我在）
- 客户端收到后回传一个数据包给服务器表示确认（好的）

**第三步：证书验证**  
- 客户端发起https请求（包含支持的SSL版本，加密算法等）
- 服务端接受请求并返回证书（包含公钥，选择的加密算法等）
- 客户端解析证书（无效则警告）

**第四步：数据传输**
- 客户端给服务端发送用证书加密后的随机值
- 服务端接收加密数据后使用私钥进行解密，得到随机值
- 服务端将解密后的随机值作为私钥对数据进行加密（选择的加密算法）然后返回给客户端
- 客户端用这个随机值（私钥）对服务端返回的数据进行解密，完成数据传输

**注意**：Https在传输证书和秘钥的过程中，使用的是非对称加密算法（保证绝对安全）；完成验证后使用的是对称算法进行数据传输（保证传输效率）。

**客户端解析证书**

- 客户端验证证书内容的有效性（过期时间，域名是否相同等）。
- 客户端根据本地根证书的（CA公钥）解密证书的数字摘要，看看是否匹配。
- 如果数字签名验证通过，就使用服务器提供的公钥进行下一步通信。

![https](https://img.upyun.zzming.cn/android/https%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B.jpg)

> [https原理拆解（附运行流程图） - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/383254610)  
> [一图说明HTTPS请求过程_我的笨毛毛的博客-CSDN博客_https的请求流程](https://blog.csdn.net/u013998466/article/details/108227756)