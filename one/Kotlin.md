# Kotlin

**Kotlin相对于Java的优势**

- Kotlin是Google推荐的Android首选开发语言。

- 空指针安全。Kotlin中变量有非空类型和可空类型，可空类型需要在变量类型后加上 ? ，在使用时Kotlin会判断变量是否为空。  
  - 非空类型的属性编译器添加@NotNull注解，可空类型添加@Nullable注解
  - 非空类型直接对参数进行判空，如果为空直接抛出异常
  - 可空类型，如果是?.判空，不空才执行后续代码，否则返回null；如果是!!，空的话直接抛出NPE异常
  - as操作符会判空，空的话直接抛出异常，不为空才执行后续操作，没做类型判断！运行时可能会报错
  - as?则是新建一个变量，参数赋值给它，然后判断是否为特定类型，赋值为null，接着把这个变量的值赋值给另一个新的变量，这里有一点注意：as?处理后的参数可能为空！！！所以调用as?转换后的对象还需要添加安全调用操作符(?.)

- 扩展函数。Kotlin可以给类添加扩展函数，方便调用。

- 函数式支持。Kotlin可以将方法当作参数来进行传递，可以减少匿名内部类的创建。

- 操作符便利。Kotlin中有apply、let、map等一系列可节省代码量的操作符。

- 协程。Kotlin的协程可以用同步的方式来写异步的代码，同时使线程间切换更加方便快捷。

## 协程

> 协程是一种并发设计模式，您可以在 Android 平台上使用它来简化异步执行的代码。

在我看来，协程和线程一样都是用来解决并发任务（异步任务）的方案。所以协程和线程是属于一个层级的概念，但是对于kotlin中的协程，又与广义的协程有所不同。kotlin中的协程其实是对线程的一种封装，或者说是一种线程框架，为了让异步任务更好更方便使用。

优点：
- 轻量：您可以在单个线程上运行多个协程，因为协程支持挂起，不会使正在运行协程的线程阻塞。挂起比阻塞节省内存，且支持多个并行操作。
- 内存泄露更少：使用结构化并发机制在一个作用域内执行多个操作。
- 内置取消支持：取消功能会自动通过正在运行的协程层次结构传播。
- Jetpack集成：许多 Jetpack 库都包含提供全面协程支持的扩展。某些库还提供自己的协程作用域，可供您用于结构化并发。